document.addEventListener("DOMContentLoaded",function(){console.log("âœ… Statistik.js loaded");function s(){return document.querySelector('meta[name="csrf-token"]')?.content||""}window.fetchStatistik=async function(t,e={}){try{const o=await fetch(t,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s(),"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},...e});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);const n=await o.json();return console.log("âœ… API Response:",n),n}catch(o){throw console.error("âŒ Fetch Error:",o),window.showToast("Gagal memuat data: "+o.message,"error"),o}},window.fetchWorkspaceData=async function(t,e="todo",o=null,n=null){let r=`/api/statistik/workspace/${t}?filter=${e}`;return o&&n&&(r+=`&start=${o}&end=${n}`),await window.fetchStatistik(r)},window.fetchMemberData=async function(t,e,o="todo",n=null,r=null){let i=`/api/statistik/member/${e}?workspace_id=${t}&filter=${o}`;return n&&r&&(i+=`&start=${n}&end=${r}`),await window.fetchStatistik(i)},window.fetchTasksByFilter=async function(t,e,o=null,n=null,r=null){let i=`/api/statistik/tasks?workspace_id=${t}&filter=${e}`;return o&&(i+=`&member_id=${o}`),n&&r&&(i+=`&start=${n}&end=${r}`),await window.fetchStatistik(i)},window.fetchPeriodeData=async function(t,e,o,n="todo",r=null){let i=`/api/statistik/periode?workspace_id=${t}&start=${e}&end=${o}&filter=${n}`;return r&&(i+=`&member_id=${r}`),await window.fetchStatistik(i)},window.animateProgressCircle=function(t,e){if(!t)return;const o=t.querySelector(".progress-bar")||t.querySelector("path[stroke-dasharray]"),n=t.querySelector(".progress-text")||t.querySelector("text");if(!o)return;const r=Math.min(Math.max(e,0),100),a=2*Math.PI*15.9155;o.style.transition="stroke-dashoffset 0.6s ease-out",o.style.strokeDasharray=`${a}`,o.style.strokeDashoffset=`${a-r/100*a}`,n&&(n.textContent=r+"%")},window.initProgressCircles=function(){document.querySelectorAll(".progress-circle, [data-progress]").forEach(t=>{const e=parseInt(t.getAttribute("data-progress"))||0;window.animateProgressCircle(t,e)})},window.formatDate=function(t,e="short"){if(!t)return"-";const o=new Date(t);if(isNaN(o.getTime()))return"-";switch(e){case"short":return o.toLocaleDateString("id-ID",{day:"numeric",month:"short"});case"long":return o.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});case"time":return o.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"});default:return o.toLocaleDateString("id-ID")}},window.isTaskOverdue=function(t,e=null){return!t||e==="done"||e==="selesai"?!1:new Date(t)<new Date},window.getStatusColor=function(t){const e={todo:"#2563eb",todo_list:"#2563eb",in_progress:"#6B7280",dikerjakan:"#6B7280",done:"#40c79a",selesai:"#40c79a",overdue:"#facc15",terlambat:"#facc15"};return e[t?.toLowerCase()]||e.todo},window.getStatusLabel=function(t){return{todo:"Todo List",todo_list:"Todo List",in_progress:"Dikerjakan",dikerjakan:"Dikerjakan",done:"Selesai",selesai:"Selesai",overdue:"Terlambat",terlambat:"Terlambat"}[t?.toLowerCase()]||"Todo List"},window.showToast=function(t,e="info"){const o=document.getElementById("toast-notification");o&&o.remove();const n=document.createElement("div");n.id="toast-notification",n.className="fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white z-50 transform transition-all duration-300";const r={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500",warning:"bg-yellow-500"};n.classList.add(r[e]||r.info),n.textContent=t,n.style.opacity="0",n.style.transform="translateY(-20px)",document.body.appendChild(n),setTimeout(()=>{n.style.opacity="1",n.style.transform="translateY(0)"},10),setTimeout(()=>{n.style.opacity="0",n.style.transform="translateY(-20px)",setTimeout(()=>n.remove(),300)},3e3)},window.debounce=function(t,e=300){let o;return function(...r){const i=()=>{clearTimeout(o),t(...r)};clearTimeout(o),o=setTimeout(i,e)}},window.showSkeleton=function(t){const e=document.querySelector(t);e&&e.classList.add("skeleton-loading")},window.hideSkeleton=function(t){const e=document.querySelector(t);e&&e.classList.remove("skeleton-loading")},window.calculatePercentage=function(t,e){return e===0?0:Math.round(t/e*100)},window.formatNumber=function(t){return new Intl.NumberFormat("id-ID").format(t)},window.animateCounter=function(t,e,o=1e3){if(!t)return;const n=parseInt(t.textContent)||0,i=(e-n)/(o/16);let a=n;const c=setInterval(()=>{a+=i,(i>0&&a>=e||i<0&&a<=e)&&(a=e,clearInterval(c)),t.textContent=Math.round(a)},16)},setTimeout(()=>{window.initProgressCircles()},100),console.log("ðŸš€ All statistik functions ready!")});
